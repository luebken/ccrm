# CRM Linter Makefile

.PHONY: help setup build lint lint-verbose test clean example init install clean-examples list-examples

# Default target
help:
	@echo "CRM Linter - Available targets:"
	@echo "  setup           Install linter dependencies"
	@echo "  build           Compile TypeScript to dist/"
	@echo "  lint            Run the CRM linter on /crm directory"
	@echo "  lint-verbose    Run linter with detailed output"
	@echo "  test            Run linter test suite"
	@echo "  clean           Clean build artifacts"
	@echo "  init            Initialize CRM directory structure"
	@echo "  example         Create example CRM entities in ./crm"
	@echo "  clean-examples  Remove example CRM entities"
	@echo "  list-examples   List example files in CRM directory"
	@echo "  install         Install linter globally (npm link)"

# Install dependencies
setup:
	@echo "ğŸ“¦ Installing linter dependencies..."
	npm install
	@echo "âœ… Dependencies installed"

# Build TypeScript
build: setup
	@echo "ğŸ”¨ Building TypeScript..."
	npm run build
	@echo "âœ… Build complete"

# Install globally for easy access
install: build
	@echo "ğŸ”— Installing linter globally..."
	npm link
	@echo "âœ… Linter installed globally as 'crm-lint'"

# Run linter on CRM directory
lint: build
	@if [ -d "../../crm" ]; then \
		echo "ğŸ” Running CRM linter..."; \
		node dist/cli.js ../../crm; \
	else \
		echo "âŒ CRM directory not found. Run 'make init' first."; \
		exit 1; \
	fi

# Run linter with verbose output
lint-verbose: build
	@if [ -d "../../crm" ]; then \
		echo "ğŸ” Running CRM linter (verbose)..."; \
		node dist/cli.js ../../crm --verbose; \
	else \
		echo "âŒ CRM directory not found. Run 'make init' first."; \
		exit 1; \
	fi

# Run tests (placeholder for future test implementation)
test: build
	@echo "ğŸ§ª Running tests..."
	@echo "âš ï¸  Tests not implemented yet"

# Initialize CRM directory structure
init: build
	@echo "ğŸ“ Initializing CRM directory structure..."
	node dist/cli.js init ../../crm
	@echo "âœ… CRM directory initialized"

# Create example entities
example: build
	@echo "ğŸ“ Creating example CRM entities..."
	node dist/cli.js example ../../crm
	@echo "âœ… Example entities created"

# Remove example entities
clean-examples: build
	@echo "ğŸ—‘ï¸  Removing example CRM entities..."
	node dist/cli.js clean-examples ../../crm
	@echo "âœ… Example entities removed"

# List example entities
list-examples: build
	@echo "ğŸ“‹ Listing example CRM entities..."
	node dist/cli.js list-examples ../../crm

# Clean build artifacts and examples
clean: clean-examples
	@echo "ğŸ§¹ Cleaning build artifacts..."
	rm -rf dist node_modules package-lock.json
	@echo "âœ… Clean complete"

# Development workflow - setup everything
dev-setup: setup build init example
	@echo "ğŸš€ Development setup complete!"
	@echo "  â€¢ Linter built and ready"
	@echo "  â€¢ CRM directory initialized"
	@echo "  â€¢ Example entities created"
	@echo ""
	@echo "Next steps:"
	@echo "  â€¢ Run 'make lint' to validate the CRM data"
	@echo "  â€¢ Run 'make install' to install globally"

# Quick validation workflow
validate: lint
	@echo "âœ… Validation complete"

# Rebuild and test cycle
rebuild: clean build lint
	@echo "ğŸ”„ Rebuild and validation complete"